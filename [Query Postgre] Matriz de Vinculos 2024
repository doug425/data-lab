SELECT date(user_signup_date) AS data_cadastro,
       CAST(user_id AS TEXT) as user_id,
       user_email,
       CASE WHEN user_is_seller = 1 then 'Vendedor' else 'Comprador' end as tipo_usuario,
       CASE WHEN user_is_seller = 1 AND user_seller_account_blocked = '0' THEN 'Liberado' 
     WHEN user_is_seller = 0 THEN '' -- Retorno vazio para compradores
     ELSE 'Bloqueado' END AS status_vendedor,
       CASE WHEN (user_login_restrictions & 8) != 0 then 'Bloqueado' else 'Liberado' end as status_login,
       user_personal_document AS CPF,
       user_cnpj as CNPJ,
       user_cellphone AS celular,
       concat(user_phone_ddd, user_phone) AS telefone,
       CONCAT( CONCAT( CONCAT( CONCAT(user_address, ', '), CONCAT(user_number, ', ') ), user_complement ), CONCAT(', ', user_city)) AS endereco
FROM snapshots.users_snapshot
WHERE (concat(user_phone_ddd, user_phone) in
         (SELECT concat(user_phone_ddd, user_phone) AS telefone
          FROM snapshots.users_snapshot
          WHERE user_id in ({{user_id}})
            AND dt = CURRENT_DATE - 1)
       OR concat(CONCAT(concat(user_address, ', '), concat(user_number, ', ')), user_city) in
         (SELECT concat(CONCAT(concat(user_address, ', '), concat(user_number, ', ')), user_city) AS endereco
          FROM snapshots.users_snapshot
          WHERE user_id in ({{user_id}})
            AND dt = CURRENT_DATE - 1)
       OR user_cellphone in 
         (SELECT user_cellphone AS celular
          FROM snapshots.users_snapshot
          WHERE user_id in ({{user_id}})
            AND dt = CURRENT_DATE - 1)
       OR user_personal_document in 
         (SELECT user_personal_document AS CPF
          FROM snapshots.users_snapshot
          WHERE user_id in ({{user_id}})
            AND dt = CURRENT_DATE - 1)
        OR user_personal_document in 
         (SELECT user_cnpj AS CNPJ
          FROM snapshots.users_snapshot
          WHERE user_id in ({{user_id}})
            AND dt = CURRENT_DATE - 1))
  AND dt = CURRENT_DATE - 1
 order by user_id = ANY(ARRAY[{{user_id}}]::int[]) DESC;
