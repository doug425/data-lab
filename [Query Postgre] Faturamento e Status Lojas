SELECT
    CAST(pagos.seller_id AS TEXT) AS seller_id,
    sellers.seller_email,
    CASE WHEN sellers.seller_shop_is_active = 1 THEN 'Ativa' ELSE 'Inativa' END AS conta_financeira,
    CASE WHEN users.user_seller_account_blocked = 0 THEN 'Desbloqueada' ELSE 'Bloqueada' END AS status_loja,
    CASE WHEN users.user_on_vacations = 0 THEN 'Não' ELSE 'Em Férias' END AS Férias,
    SUM(CASE WHEN EXTRACT(YEAR FROM pagos.dt) = 2023 AND EXTRACT(MONTH FROM pagos.dt) = 12 THEN pagos.total_value ELSE 0 END) AS dez_23,
    SUM(CASE WHEN EXTRACT(YEAR FROM pagos.dt) = 2024 AND EXTRACT(MONTH FROM pagos.dt) = 1 THEN pagos.total_value ELSE 0 END) AS jan_24,
    SUM(CASE WHEN EXTRACT(YEAR FROM pagos.dt) = 2024 AND EXTRACT(MONTH FROM pagos.dt) = 2 THEN pagos.total_value ELSE 0 END) AS fev_24,
    SUM(pagos.total_value) AS faturamento_1_ano
FROM
    data_warehouse.confirmed_billable_orders pagos
JOIN
    data_warehouse.sellers sellers ON pagos.seller_id = sellers.seller_id
JOIN
    snapshots.users_snapshot users on sellers.seller_id = users.user_id
WHERE
    sellers.dt = CURRENT_DATE - INTERVAL '1' DAY
    AND users.dt = CURRENT_DATE - INTERVAL '1' DAY
    AND pagos.dt >= CURRENT_DATE - INTERVAL '365' DAY
GROUP BY
    1, 2, 3, 4, 5
ORDER BY
    9 DESC
